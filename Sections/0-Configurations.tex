\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb, dsfont, bm, mathrsfs} % Math stuff
\usepackage{graphicx}
\usepackage{relsize}
\usepackage{float}
%\floatstyle{boxed}
\restylefloat{figure}
\usepackage{subcaption}
\usepackage{url}
\usepackage[font={small,it}]{caption}
\usepackage{multicol,multirow}
\usepackage{fancyhdr}
\usepackage{color}
\usepackage[table]{xcolor}
\usepackage{flafter} % Floats after references
\usepackage{eso-pic} % Background picture on title page
\usepackage{natbib} % for citep and citet citations
\usepackage[section]{placeins}
\usepackage{listings} % Para escrever códigos
\usepackage{adjustbox}
%\usepackage{icomma} % Para tirar o espaço após a virgula no modo matemático
%\usepackage{array} % Para adicionar espaço nas células, de forma que o overline não seja ocultado.
%\setlength{\extrarowheight}{.5ex} Usar com o package acima
%\usepackage[outline]{contour}
\DeclareMathOperator*{\aprox}{\approx}
\usepackage[a4paper, left=3cm, right=2cm, top=3cm, bottom=2cm]{geometry}
\usepackage[space]{grffile}
%\usepackage{showframe}
%\usepackage{fullpage}
%\usepackage{comment}
\usepackage[onehalfspacing]{setspace} % Ajustar espaçamento
\usepackage[nottoc]{tocbibind}

% Tabelas
\usepackage{booktabs, threeparttable, makecell} %siunitx
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}

% Minted
%\usepackage{minted}
%\usemintedstyle{pastie}

% Numerate lines
%\usepackage{lineno}
%\linenumbers

% Def to create a new blank page
\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage}

% Fancy Header Config
\fancyhead{}
\fancyfoot{}
\fancyhead[RO,LE]{\thepage}
\fancyhead[CE]{\nouppercase\leftmark}
\fancyhead[CO]{\nouppercase\rightmark}
\pagestyle{fancy}
\renewcommand{\sectionmark}[1]{\markright{\scriptsize{\slshape{\fontsize{10}{12} \selectfont Section \thesection.\  #1}}}}
\renewcommand{\headrulewidth}{0.7pt}
\setlength{\headheight}{14pt}

% Custom Commands
\newcommand{\red}[1]{\textcolor{red}{#1}}
\definecolor{lightgray}{gray}{0.7}
\newcommand{\hsp}{\hspace{15pt}}
\definecolor{gray75}{gray}{0.75}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{emptypage}
\usepackage{titlesec, blindtext}

% Modification to the table of contents
\renewcommand\contentsname{Table of Contents}
\titleformat{\chapter}[display]
{\bfseries\Huge}
{{\chaptertitlename} \large\thechapter}
{2ex}
{\titlerule\vspace{2ex}}
\titleformat{name=\chapter,numberless}[display]
{\bfseries\Huge}
{\color{gray75}{\titlerule[0.8pt]}}
{-7ex}
{\bfseries\Huge}[\vspace{1ex}]

% Changing how chapters, sections and subsections are shown
\titleformat{\chapter}[hang]{\Huge\bfseries}{\thechapter\hsp\textcolor{gray75}{}\hsp}{0pt}{\Huge\bfseries}[\vspace{0.8ex}\color{gray75}{\titlerule[.8pt]}]

\titleformat{\section}[hang]{\LARGE\bfseries}{\thesection\hspace{19pt}\textcolor{gray75}{|}\hspace{14pt}}{0pt}{\LARGE\bfseries}[\vspace{0.8ex}]

\titleformat{\subsection}[hang]{\large\bfseries}{\makebox[1cm]{\thesubsection}\hsp\textcolor{gray75}{|}\hsp}{0pt}{\large\bfseries}[\vspace{0.8ex}]

% Background image on first page
\newcommand\BackgroundPic{%
    \put(0,0){%
        \parbox[b][\paperheight]{\paperwidth}{%
            \vfill
            \centering
            \includegraphics[width=.9\paperwidth,height=.9\paperheight,%
                keepaspectratio]{Images/brasao_usp_pb_c}%
            \vfill
        }}}

% Defining a page of acronyms
\usepackage[printonlyused,withpage]{acronym}
\usepackage{etoolbox}
\makeatletter
\patchcmd{\AC@@acro}
{\dotfill\pageref{acro:#1}}
{\nobreak\leaders\hbox{$\mkern -7mu \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu \mkern 7mu$}%
    \hfill\nobreak\makebox[1.3em][r]{\pageref{acro:#1}}}
{}
{}
\makeatother

\makeatletter
\newif\if@in@acrolist
\AtBeginEnvironment{acronym}{\@in@acrolisttrue}
\newrobustcmd{\LU}[2]{\if@in@acrolist#1\else#2\fi}

\newcommand{\ACF}[1]{{\@in@acrolisttrue\acf{#1}}}
\makeatother

% Hyper references (links)
\usepackage{hyperref} % Should be loaded last
\hypersetup{
    colorlinks,
    linkcolor=blue,
    anchorcolor=blue,
    citecolor=blue,
    filecolor=blue,
    menucolor=blue,
    runcolor=blue,
    urlcolor=blue,}

% ABNT stuff
\def\labelitemi{\normalfont\bfseries \textendash} % Listas usando -

\makeatletter
\setlength{\@fpsep}{1cm} % adjust value as you need
\makeatother

\makeatletter
\AtBeginDocument{%
    \expandafter\renewcommand\expandafter\subsection\expandafter{%
        \expandafter\@fb@secFB\subsection
    }%
}
\makeatother

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\titlespacing{\chapter}{0pt}{0pt}{1.5cm}
\titlespacing{\section}{0pt}{1.5cm}{1.5cm}
\titlespacing{\subsection}{0pt}{1.5cm}{1.5cm}
\titlespacing{\subsubsection}{0pt}{1.5cm}{1.5cm}

\def\textfraction{0.1}
\graphicspath{{Images/}}